(()=>{if(window.__followBot){alert('Already running');return}window.__followBot=true;const S={run:true,delay:650,scrollDelay:2000,empty:0,totalFollow:0,totalSurf:0,clickedButtons:new Set(),followedAccounts:new Set(),currentPage:'unknown',lastScrollY:0,stableScrollCount:0,dynamicLoads:0,justSurfed:false};const C={red:'#ef4444',redDim:'#b91c1c',blue:'#3b82f6',bg:'rgba(14,14,16,.88)',card:'0 8px 30px rgba(0,0,0,.35)'};const ui=document.createElement('div');ui.style.cssText='position:fixed;right:12px;bottom:12px;z-index:2147483647;background:'+C.bg+';backdrop-filter:blur(6px);color:#fff;padding:12px 14px;border-radius:14px;box-shadow:'+C.card+';font:12px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;min-width:250px;text-align:center';ui.innerHTML='<div style="margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,.16);padding-bottom:6px;font-size:12px;font-weight:600">블라이, \'상위노출\' 분석 서비스 : <a href="https://blai.co.kr?invite=늑대왕" target="_blank" rel="noopener" style="color:#9ccfff;text-decoration:underline">바로가기</a></div><div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:4px"><b style="font-size:13px">Clip Follow Surfer</b><span id="bdg" style="padding:2px 8px;border-radius:999px;background:#10b981;color:#052;font-weight:700;font-size:10px;letter-spacing:.25px">RUN</span></div><div id="st" style="opacity:.95;font-size:11px;line-height:1.4">팔로우: <b id="followCount">0</b> | 파도타기: <b id="surfCount">0</b><br>동적로딩: <span id="dynamicCount">0</span> | 연속미탐지: <span id="emptyCount">0</span></div><div id="currentAction" style="opacity:.8;font-size:10px;color:#9ccfff;margin:4px 0;min-height:15px;display:flex;align-items:center;justify-content:center">탐지중...</div><div id="btnRow" style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;justify-content:center"><button id="p" style="flex:1 1 auto;width:80%;padding:6px 10px;border:0;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 1px 0 rgba(255,255,255,.07) inset,0 2px 10px rgba(0,0,0,.25);transition:transform .08s ease,filter .15s ease,opacity .2s ease">Stop</button><button id="c" style="flex:1 1 auto;width:38%;padding:6px 10px;border:0;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 1px 0 rgba(255,255,255,.07) inset,0 2px 10px rgba(0,0,0,.25);transition:transform .08s ease,filter .15s ease,opacity .2s ease;display:none">Close</button></div><div style="margin-top:10px;border-top:1px solid rgba(255,255,255,.16);padding-top:8px;font-size:10px;opacity:.7">버전 : 2025.08.16 12:22:00</div>';document.body.appendChild(ui);const ST=ui.querySelector('#st'),pBtn=ui.querySelector('#p'),cBtn=ui.querySelector('#c'),BDG=ui.querySelector('#bdg'),ACTION=ui.querySelector('#currentAction'),followCountEl=ui.querySelector('#followCount'),surfCountEl=ui.querySelector('#surfCount'),dynamicCountEl=ui.querySelector('#dynamicCount'),emptyCountEl=ui.querySelector('#emptyCount');const setBtnColor=(btn,bg)=>{btn.style.background=bg;btn.style.color='#fff'};const addHover=(btn)=>{btn.onmouseenter=()=>btn.style.filter='brightness(1.06)';btn.onmouseleave=()=>btn.style.filter='none';btn.onmousedown=()=>btn.style.transform='scale(0.98)';btn.onmouseup=()=>btn.style.transform='scale(1)'};addHover(pBtn);addHover(cBtn);const L={follow:'팔로우',surf:'파도타기',paused:'일시정지',done:'100회 완료'};const updateCounts=()=>{followCountEl.textContent=S.totalFollow;surfCountEl.textContent=S.totalSurf;dynamicCountEl.textContent=S.dynamicLoads;emptyCountEl.textContent=S.empty};const render=(action='')=>{if(action)ACTION.textContent=action};const setRunning=()=>{S.run=true;pBtn.textContent='Stop';setBtnColor(pBtn,C.red);pBtn.style.width='80%';cBtn.style.display='none';BDG.textContent='서핑중';BDG.style.background='#10b981';render('동작중...')};const setPaused=(r=L.paused)=>{S.run=false;pBtn.textContent='Resume';setBtnColor(pBtn,C.blue);pBtn.style.width='38%';cBtn.style.display='inline-block';setBtnColor(cBtn,C.redDim);BDG.textContent='휴식중';BDG.style.background='#f59e0b';render(r)};pBtn.onclick=()=>{S.run?setPaused():setRunning()};cBtn.onclick=()=>{try{clearInterval(loop)}catch{}try{clearInterval(scroller)}catch{};try{clearInterval(uiUpdater)}catch{};try{obs&&obs.disconnect()}catch{};window.__followBot=false;try{ui.remove()}catch{}};addEventListener('keydown',e=>{if(e.key==='Escape')pBtn.click()});const QQ=s=>Array.from(document.querySelectorAll(s));const txt=e=>(e.textContent||'').replace(/\s+/g,'').trim();const vis=e=>{const r=e.getBoundingClientRect();return r.bottom>=0&&r.top<=innerHeight+400};const sleep=ms=>new Promise(r=>setTimeout(r,ms));const detectPageType=()=>{if(location.pathname.includes('/@')){if(QQ('[class*="UIProfileInfo"],[class*="UIProfileHeader"]').length){S.currentPage='profile';return'profile'}}if(QQ('li[class*="UIProfileListItem"]').length>0||QQ('[class*="MyFollowProfileSection"]').length>0){S.currentPage='list';return'list'}S.currentPage='unknown';return'unknown'};function isFollowingButton(button){const t=txt(button);return/팔로잉|Following|언팔로우/.test(t)||button.getAttribute('aria-pressed')==='true'}function extractAccountIdFromButton(button){let accountId=null;const parent=button.closest('li[class*="UIProfileListItem"]')||button.closest('[class*="UIRecommendCreatorCarouselType_list_item"]')||button.closest('div[class*="list_item"]');if(parent){const idEl=parent.querySelector('[class*="UIProfileListItem_txt_area"],[class*="UIRecommendCreatorCarouselType_tit_area"],[class*="tit_area"]');if(idEl){accountId=idEl.textContent?.trim();if(accountId&&accountId.length>0&&!accountId.includes('팔로우')){return accountId.replace(/^@/,'')}}const linkEl=parent.querySelector('a[href*="/@"]');if(linkEl){const href=linkEl.getAttribute('href')||'';const match=href.match(/\/@([^/?#]+)/);if(match){return decodeURIComponent(match[1])}}}return extractIdFromEl(button)||'unknown_'+Math.random().toString(36).substr(2,9)}function findFollowableButtons(){return QQ('button,a,[role="button"]').filter(b=>{const t=txt(b);const isFollowBtn=/팔로우/.test(t)&&!/팔로잉|팔로우중|Following|언팔로우/i.test(t)&&!isFollowingButton(b);const isEnabled=!b.closest('[disabled],[aria-disabled="true"]')&&b.getAttribute('aria-pressed')!=='true';const accountId=extractAccountIdFromButton(b);const notFollowed=!S.followedAccounts.has(accountId);const buttonId=b.dataset.buttonId||'btn_'+Math.random().toString(36).substr(2,9);if(!b.dataset.buttonId)b.dataset.buttonId=buttonId;const notClicked=!S.clickedButtons.has(buttonId);return isFollowBtn&&isEnabled&&notFollowed&&notClicked})}function findSurfableProfiles(){const candidates=[];const listSel='li[class*="UIProfileListItem_list_item"],li[class^="UIProfileListItem_list_item"]';const items=QQ(listSel);for(const li of items){const link=li.querySelector('a[href^="/@"],a[href*="/@"],a[role="button"],[role="button"]');const id=extractIdFromEl(link||li);if(id){candidates.push({id,link:link||li,element:li})}}const anchors=QQ('a[href^="/@"],a[href*="/@"]').filter(a=>vis(a));for(const a of anchors){const id=extractIdFromEl(a);if(id&&!candidates.find(c=>c.id===id)){candidates.push({id,link:a,element:a})}}return candidates.filter(c=>vis(c.element))}function extractAccountName(button){const parent=button.closest('li[class*="UIProfileListItem"]')||button.closest('[class*="UIRecommendCreatorCarouselType_list_item"]')||button.closest('div[class*="list_item"]');if(parent){const idEl=parent.querySelector('[class*="UIProfileListItem_txt_area"],[class*="UIRecommendCreatorCarouselType_tit_area"],[class*="tit_area"]');if(idEl){const accountId=idEl.textContent?.trim();if(accountId&&accountId.length>0&&!accountId.includes('팔로우')){return'@'+accountId}}const nameEl=parent.querySelector('[class*="UIProfileListItem_tit_area"],[class*="UIRecommendCreatorCarouselType_tit_area"],[class*="tit_area"]');if(nameEl){const accountName=nameEl.textContent?.trim();if(accountName&&accountName.length>0&&!accountName.includes('팔로우')){return accountName.slice(0,15)}}const linkEl=parent.querySelector('a[href*="/@"]');if(linkEl){const href=linkEl.getAttribute('href')||'';const match=href.match(/\/@([^/?#]+)/);if(match){return'@'+decodeURIComponent(match[1])}}}const siblings=Array.from(button.parentElement?.children||[]);for(const sibling of siblings){if(sibling!==button){const text=sibling.textContent?.trim();if(text&&text.length>2&&!text.includes('팔로우')&&!/^\d+$/.test(text))return text.slice(0,15)}}return'알수없음'}function extractIdFromEl(el){let id=null;const href=(el.getAttribute&&el.getAttribute('href'))||'';const mh=href.match(/\/@([^/?#]+)/);if(mh)id=decodeURIComponent(mh[1]);if(!id){const t=(el.innerText||el.textContent||'').trim();const mt=t.match(/@([A-Za-z0-9._-]{3,32})/);if(mt)id=mt[1]}if(!id&&el){const idNode=el.querySelector&&el.querySelector('[class*="UIProfileListItem_txt_area"],[class*="UIProfileListItem_tit_area"],[class*="UIRecommendCreatorCarouselType_tit_area"],[class*="tit_area"]');if(idNode){id=(idNode.innerText||'').trim().replace(/^@/,'').replace(/\s+/g,'')}}if(id)id=id.replace(/^@/,'').replace(/\s+/g,'');if(id&&!/^[A-Za-z0-9._-]{3,32}$/.test(id))id=null;return id}async function ensureMoreCandidates(){const listSel='li[class*="UIProfileListItem_list_item"],li[class^="UIProfileListItem_list_item"]';let items=QQ(listSel).filter(vis);if(items.length<=3){render('더 많은 후보 로딩중...');const currentY=window.scrollY;scrollTo(0,document.body.scrollHeight);await sleep(700);scrollBy(0,-Math.floor(innerHeight*0.5));await sleep(300);scrollTo(0,currentY);await sleep(400);S.dynamicLoads++}}async function triggerDynamicLoading(){render('동적 로딩 중...');scrollTo(0,document.body.scrollHeight);await sleep(1000);scrollBy(0,-Math.floor(innerHeight*0.3));await sleep(500);scrollTo(0,document.body.scrollHeight);await sleep(1000);S.dynamicLoads++;const newHeight=document.documentElement.scrollHeight;scrollBy(0,-Math.floor(innerHeight*0.5));await sleep(500);render('동적 로딩 완료');S.dynamicLoads++;return true}async function clickRecommendButtons(){let n=0;const recommendFollowBtns=QQ('[class*="MyFollowProfileSection_recommend_area"] button,[class*="MyFollowProfileSection_recommend_area"] a,[class*="MyFollowProfileSection_recommend_area"] [role="button"]').filter(b=>{const t=txt(b);const isFollowBtn=/팔로우/.test(t)&&!/팔로잉|팔로우중|Following|언팔로우/i.test(t)&&!isFollowingButton(b);const isEnabled=!b.closest('[disabled],[aria-disabled="true"]')&&b.getAttribute('aria-pressed')!=='true';const accountId=extractAccountIdFromButton(b);const notFollowed=!S.followedAccounts.has(accountId);const buttonId=b.dataset.buttonId||'btn_'+Math.random().toString(36).substr(2,9);if(!b.dataset.buttonId)b.dataset.buttonId=buttonId;const notClicked=!S.clickedButtons.has(buttonId);return isFollowBtn&&isEnabled&&notFollowed&&notClicked});render('창작자 추천: '+recommendFollowBtns.length+'개');for(const b of recommendFollowBtns){if(isFollowingButton(b))continue;const accountId=extractAccountIdFromButton(b);if(S.followedAccounts.has(accountId))continue;const buttonId=b.dataset.buttonId;if(S.clickedButtons.has(buttonId))continue;S.followedAccounts.add(accountId);S.clickedButtons.add(buttonId);b.scrollIntoView({block:'center',behavior:'smooth'});const isVisible=vis(b);await sleep(isVisible?300:800);const accountName=extractAccountName(b);b.dispatchEvent(new MouseEvent('mouseover',{bubbles:true}));b.dispatchEvent(new MouseEvent('mousedown',{bubbles:true}));b.click();b.dispatchEvent(new MouseEvent('mouseup',{bubbles:true}));n++;S.totalFollow++;render('추천 팔로우: '+accountName+(isVisible?'':'(스크롤됨)'));await sleep(S.delay)}return n}async function clickAllFollows(){let n=0;const hasRecommendArea=QQ('[class*="MyFollowProfileSection_recommend_area"]').length>0;if(hasRecommendArea){n+=await clickRecommendButtons()}const followBtns=findFollowableButtons();render('일반 팔로우: '+followBtns.length+'개');for(const b of followBtns){if(isFollowingButton(b))continue;const accountId=extractAccountIdFromButton(b);if(S.followedAccounts.has(accountId))continue;const buttonId=b.dataset.buttonId;if(S.clickedButtons.has(buttonId))continue;S.followedAccounts.add(accountId);S.clickedButtons.add(buttonId);b.scrollIntoView({block:'center',behavior:'smooth'});const isVisible=vis(b);await sleep(isVisible?300:800);const accountName=extractAccountName(b);b.dispatchEvent(new MouseEvent('mouseover',{bubbles:true}));b.dispatchEvent(new MouseEvent('mousedown',{bubbles:true}));b.click();b.dispatchEvent(new MouseEvent('mouseup',{bubbles:true}));n++;S.totalFollow++;render('팔로우: '+accountName+(isVisible?'':'(스크롤됨)'));await sleep(S.delay)}if(n===0&&S.empty>=2&&!S.justSurfed){const beforeBtnsCount=findFollowableButtons().length;const loaded=await triggerDynamicLoading();if(loaded){await sleep(500);const afterBtnsCount=findFollowableButtons().length;if(afterBtnsCount>beforeBtnsCount){S.empty=0;render('새 버튼 '+afterBtnsCount+'개 발견');}else{S.empty++;render('새 버튼 없음 (미탐지:'+S.empty+')')}}return 0}if(!S.justSurfed){S.empty=n?0:S.empty+1}return n}function gotoFollowerTabIfSeen(){const cand=QQ('a,button,[role="button"]').find(el=>/팔로워/i.test(el.textContent||''));if(cand){render('팔로워 탭 클릭중...');cand.click();return true}return false}async function surfNextProfile(){render('파도타기 준비중...');await ensureMoreCandidates();let candidates=findSurfableProfiles();if(candidates.length===0){await ensureMoreCandidates();candidates=findSurfableProfiles()}if(candidates.length===0){render('파도타기할 프로필 없음');return false}const cand=candidates[Math.floor(Math.random()*candidates.length)];S.totalSurf++;render('파도타기: @'+cand.id);cand.link.scrollIntoView({block:'center'});cand.link.click();S.justSurfed=true;setTimeout(()=>{S.justSurfed=false},3000);await sleep(1000);S.dynamicLoads++;gotoFollowerTabIfSeen();await sleep(500);scrollTo(0,0);return true}let lastH=0,stuck=0;const scroller=setInterval(()=>{if(!S.run)return;const pageType=detectPageType();if(pageType==='profile')return;const currentY=window.scrollY;if(Math.abs(currentY-S.lastScrollY)<10){S.stableScrollCount++;if(S.stableScrollCount>=3){scrollBy(0,Math.floor(innerHeight*0.3));S.stableScrollCount=0}}else{S.stableScrollCount=0}S.lastScrollY=currentY;const h=document.documentElement.scrollHeight;if(h===lastH)stuck++;else{stuck=0;lastH=h}if(stuck>10){render('스크롤 막힘 - 파도타기 시도중...');surfNextProfile().then(success=>{if(success){stuck=0;S.clickedButtons.clear();S.stableScrollCount=0}else{stuck=0;S.clickedButtons.clear();S.stableScrollCount=0}})}},1800);let justNavigated=false,obs=new MutationObserver(()=>{if(justNavigated)return;detectPageType();if(QQ('[class*="UIProfileInfo"],[class*="UIProfileHeader"]').length){setTimeout(()=>gotoFollowerTabIfSeen(),500)}});obs.observe(document.documentElement,{childList:true,subtree:true});const uiUpdater=setInterval(updateCounts,100);const loop=setInterval(async()=>{if(!S.run)return;const pageType=detectPageType();if(pageType!=='profile'){const clicked=await clickAllFollows();if(clicked>0){await sleep(1500)}}if(S.totalSurf>=100){setPaused(L.done);return}if(S.empty>=5&&pageType==='list'&&!S.justSurfed){render('파도타기 시작...');if(await surfNextProfile()){justNavigated=true;setTimeout(()=>justNavigated=false,2000);S.empty=0;S.dynamicLoads=0;S.clickedButtons.clear();S.stableScrollCount=0}}},1000);setRunning();updateCounts()})()
